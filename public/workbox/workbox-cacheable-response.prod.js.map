{"version":3,"file":"workbox-cacheable-response.prod.js","sources":["../_version.js","../CacheableResponse.js","../CacheableResponsePlugin.js"],"sourcesContent":["\"use strict\";\r\n// @ts-ignore\r\ntry {\r\n    self['workbox:cacheable-response:6.1.5'] && _();\r\n}\r\ncatch (e) { }\r\n","/*\r\n  Copyright 2018 Google LLC\r\n\r\n  Use of this source code is governed by an MIT-style\r\n  license that can be found in the LICENSE file or at\r\n  https://opensource.org/licenses/MIT.\r\n*/\r\nimport { assert } from 'workbox-core/_private/assert.js';\r\nimport { WorkboxError } from 'workbox-core/_private/WorkboxError.js';\r\nimport { getFriendlyURL } from 'workbox-core/_private/getFriendlyURL.js';\r\nimport { logger } from 'workbox-core/_private/logger.js';\r\nimport './_version.js';\r\n/**\r\n * This class allows you to set up rules determining what\r\n * status codes and/or headers need to be present in order for a\r\n * [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response)\r\n * to be considered cacheable.\r\n *\r\n * @memberof module:workbox-cacheable-response\r\n */\r\nclass CacheableResponse {\r\n    /**\r\n     * To construct a new CacheableResponse instance you must provide at least\r\n     * one of the `config` properties.\r\n     *\r\n     * If both `statuses` and `headers` are specified, then both conditions must\r\n     * be met for the `Response` to be considered cacheable.\r\n     *\r\n     * @param {Object} config\r\n     * @param {Array<number>} [config.statuses] One or more status codes that a\r\n     * `Response` can have and be considered cacheable.\r\n     * @param {Object<string,string>} [config.headers] A mapping of header names\r\n     * and expected values that a `Response` can have and be considered cacheable.\r\n     * If multiple headers are provided, only one needs to be present.\r\n     */\r\n    constructor(config = {}) {\r\n        if (process.env.NODE_ENV !== 'production') {\r\n            if (!(config.statuses || config.headers)) {\r\n                throw new WorkboxError('statuses-or-headers-required', {\r\n                    moduleName: 'workbox-cacheable-response',\r\n                    className: 'CacheableResponse',\r\n                    funcName: 'constructor',\r\n                });\r\n            }\r\n            if (config.statuses) {\r\n                assert.isArray(config.statuses, {\r\n                    moduleName: 'workbox-cacheable-response',\r\n                    className: 'CacheableResponse',\r\n                    funcName: 'constructor',\r\n                    paramName: 'config.statuses',\r\n                });\r\n            }\r\n            if (config.headers) {\r\n                assert.isType(config.headers, 'object', {\r\n                    moduleName: 'workbox-cacheable-response',\r\n                    className: 'CacheableResponse',\r\n                    funcName: 'constructor',\r\n                    paramName: 'config.headers',\r\n                });\r\n            }\r\n        }\r\n        this._statuses = config.statuses;\r\n        this._headers = config.headers;\r\n    }\r\n    /**\r\n     * Checks a response to see whether it's cacheable or not, based on this\r\n     * object's configuration.\r\n     *\r\n     * @param {Response} response The response whose cacheability is being\r\n     * checked.\r\n     * @return {boolean} `true` if the `Response` is cacheable, and `false`\r\n     * otherwise.\r\n     */\r\n    isResponseCacheable(response) {\r\n        if (process.env.NODE_ENV !== 'production') {\r\n            assert.isInstance(response, Response, {\r\n                moduleName: 'workbox-cacheable-response',\r\n                className: 'CacheableResponse',\r\n                funcName: 'isResponseCacheable',\r\n                paramName: 'response',\r\n            });\r\n        }\r\n        let cacheable = true;\r\n        if (this._statuses) {\r\n            cacheable = this._statuses.includes(response.status);\r\n        }\r\n        if (this._headers && cacheable) {\r\n            cacheable = Object.keys(this._headers).some((headerName) => {\r\n                return response.headers.get(headerName) === this._headers[headerName];\r\n            });\r\n        }\r\n        if (process.env.NODE_ENV !== 'production') {\r\n            if (!cacheable) {\r\n                logger.groupCollapsed(`The request for ` +\r\n                    `'${getFriendlyURL(response.url)}' returned a response that does ` +\r\n                    `not meet the criteria for being cached.`);\r\n                logger.groupCollapsed(`View cacheability criteria here.`);\r\n                logger.log(`Cacheable statuses: ` +\r\n                    JSON.stringify(this._statuses));\r\n                logger.log(`Cacheable headers: ` +\r\n                    JSON.stringify(this._headers, null, 2));\r\n                logger.groupEnd();\r\n                const logFriendlyHeaders = {};\r\n                response.headers.forEach((value, key) => {\r\n                    logFriendlyHeaders[key] = value;\r\n                });\r\n                logger.groupCollapsed(`View response status and headers here.`);\r\n                logger.log(`Response status: ` + response.status);\r\n                logger.log(`Response headers: ` +\r\n                    JSON.stringify(logFriendlyHeaders, null, 2));\r\n                logger.groupEnd();\r\n                logger.groupCollapsed(`View full response details here.`);\r\n                logger.log(response.headers);\r\n                logger.log(response);\r\n                logger.groupEnd();\r\n                logger.groupEnd();\r\n            }\r\n        }\r\n        return cacheable;\r\n    }\r\n}\r\nexport { CacheableResponse };\r\n","/*\r\n  Copyright 2018 Google LLC\r\n\r\n  Use of this source code is governed by an MIT-style\r\n  license that can be found in the LICENSE file or at\r\n  https://opensource.org/licenses/MIT.\r\n*/\r\nimport { CacheableResponse } from './CacheableResponse.js';\r\nimport './_version.js';\r\n/**\r\n * A class implementing the `cacheWillUpdate` lifecycle callback. This makes it\r\n * easier to add in cacheability checks to requests made via Workbox's built-in\r\n * strategies.\r\n *\r\n * @memberof module:workbox-cacheable-response\r\n */\r\nclass CacheableResponsePlugin {\r\n    /**\r\n     * To construct a new CacheableResponsePlugin instance you must provide at\r\n     * least one of the `config` properties.\r\n     *\r\n     * If both `statuses` and `headers` are specified, then both conditions must\r\n     * be met for the `Response` to be considered cacheable.\r\n     *\r\n     * @param {Object} config\r\n     * @param {Array<number>} [config.statuses] One or more status codes that a\r\n     * `Response` can have and be considered cacheable.\r\n     * @param {Object<string,string>} [config.headers] A mapping of header names\r\n     * and expected values that a `Response` can have and be considered cacheable.\r\n     * If multiple headers are provided, only one needs to be present.\r\n     */\r\n    constructor(config) {\r\n        /**\r\n         * @param {Object} options\r\n         * @param {Response} options.response\r\n         * @return {Response|null}\r\n         * @private\r\n         */\r\n        this.cacheWillUpdate = async ({ response }) => {\r\n            if (this._cacheableResponse.isResponseCacheable(response)) {\r\n                return response;\r\n            }\r\n            return null;\r\n        };\r\n        this._cacheableResponse = new CacheableResponse(config);\r\n    }\r\n}\r\nexport { CacheableResponsePlugin };\r\n"],"names":["self","_","e","CacheableResponse","constructor","config","_statuses","statuses","_headers","headers","isResponseCacheable","response","cacheable","this","includes","status","Object","keys","some","headerName","get","cacheWillUpdate","async","_cacheableResponse"],"mappings":"sFAEA,IACIA,KAAK,qCAAuCC,IAEhD,MAAOC,ICeP,MAAMC,EAeFC,YAAYC,EAAS,SA0BZC,EAAYD,EAAOE,cACnBC,EAAWH,EAAOI,QAW3BC,oBAAoBC,OASZC,GAAY,SACZC,KAAKP,IACLM,EAAYC,KAAKP,EAAUQ,SAASH,EAASI,SAE7CF,KAAKL,GAAYI,IACjBA,EAAYI,OAAOC,KAAKJ,KAAKL,GAAUU,MAAMC,GAClCR,EAASF,QAAQW,IAAID,KAAgBN,KAAKL,EAASW,MA8B3DP,0DCtGf,MAeIR,YAAYC,QAOHgB,gBAAkBC,OAASX,SAAAA,KACxBE,KAAKU,EAAmBb,oBAAoBC,GACrCA,EAEJ,UAENY,EAAqB,IAAIpB,EAAkBE"}